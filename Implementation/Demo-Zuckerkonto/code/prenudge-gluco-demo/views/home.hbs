<div class="container container-home py-4">

    <div class="alert {{prenudgeClass}}" role="alert">
        <div class="d-flex align-items-center">
            <img src="/images/prenudge_notext.png" alt="PreNudge" class="me-2"/>
            <div class="flex-grow-1">{{{prenudgeText}}}</div>
            <a class="btn {{prenudgeButtonClass}} ms-2 btn-sm" href="/home/prenudge"
               role="button">{{prenudgeButton}}</a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <h2>Kontostand</h2>

            <div class="text-muted">Ihr Kontostand wird anhand der Blutzuckerwerte berechnet. Werte im Zielbereich erhöhen Ihren Kontostand,
                hingegen Werte außerhalb vom Zielbereich verringern Ihren Kontostand um das Zweifache.</div>

            <div class="d-flex align-items-center account-balance">
                <img src="/images/sugar.png" alt="Kontostand" class="me-3">

                <div class="flex-grow-1">
                    <p class="mb-0">
                        {{balance}}
                    </p>
                </div>
            </div>

            <div class="d-flex flex-column">
                <div class="d-flex justify-content-between">
                    <div><h6>Durchschnittswert</h6></div>
                    <div><i class="bi bi-slash-circle"></i> {{avgGlucose}} mg/dl</div>
                </div>
                <div class="d-flex justify-content-between">
                    <div><h6>Zielbereich</h6>
                    </div>
                    <div>{{user.targetBgLower}} bis {{user.targetBgUpper}} mg/dl
                        <button
                                type="button"
                                class="btn btn-primary btn-link btn-sm ms-1"
                                data-bs-toggle="modal"
                                data-bs-target="#bgRangeModal"
                                title="Zielbereich bearbeiten">
                            <i class="bi bi-pencil"></i>
                        </button>
                    </div>
                </div>
                <div class="d-flex justify-content-between">
                    <div><h6>Werte im Zielbereich</h6></div>
                    <div>
                        <div class="badge text-bg-success rounded-pill">
                            {{inBgRangeCtn}}
                        </div> in und
                        <div class="badge text-bg-warning rounded-pill">
                            {{outOfBgRangeCtn}}
                        </div> außerhalb
                    </div>
                </div>
                <div class="d-flex justify-content-between">
                    <div><h6>PreNudge Übertragungen</h6></div>
                    <div>{{preNudgeOkCtn}} erfolgreich und {{preNudgeErrorCtn}} mit Fehler</div>
                </div>
            </div>

            <h2 class="mt-4">Letzte Transaktionen</h2>
            <div class="measurement-list" id="async-measurement-list">

            </div>
            <div class="measurement-list" style="display: none">

                {{#unless latestMeasurements.length}}
                    <div class="measurements-empty">
                        Du hast noch keine Einzahlungen gemacht.<br/>
                        Zahle noch heute auf dein Konto ein, um unglaubliche Prämien zu gewinnen.
                    </div>
                {{/unless}}

                {{#if latestMeasurements.length}}
                    <ol class="list-group">
                        {{#each latestMeasurements}}
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                                <div>
                                    {{#if this.syncedToPrenudge}}
                                        <img class="measurement-icon" src="/images/prenudge_notext.png"
                                             alt="Mit PreNudge synchronisiert"/>
                                    {{else}}
                                        <img class="measurement-icon filter-bw" src="/images/prenudge_notext.png"
                                             alt="Nicht mit PreNudge synchronisiert"/>
                                    {{/if}}
                                </div>
                                <div class="ms-2 me-auto">
                                    <div class="fw-bold mb-1">Einzahlung</div>
                                    {{dateFormat time "DD.MM.YYYY HH:mm"}}
                                </div>
                                <span class="measurement-value badge text-bg-success rounded-pill">+{{this.value}}
                                    mg/dl</span>
                            </li>
                        {{/each}}
                    </ol>
                {{/if}}


            </div>
        </div>
        <div class="col-md-6">
            <h2>Einzahlung machen</h2>

            <div class="lead mb-4">
                Nutzen Sie unseren bequemen Online-Service um Ihre Blutzuckerwerte ganz einfach auf Ihr Zuckerkonto
                einzuzahlen.
            </div>

            <form action="/home/measurement" method="post">

                <div class="form-floating">
                    <div class="input-group input-group-lg mb-3">
                        <input name="measurement" id="measurementInput" type="number" min="0" max="1000"
                               class="form-control" placeholder="Messwert" aria-label="Messwert"
                               aria-describedby="unit">
                        <span class="input-group-text" id="unit">mg/dl</span>
                    </div>
                </div>

                <button class="btn btn-primary py-2 float-end" type="submit">Einzahlen</button>
            </form>
        </div>
    </div>

    <div class="modal fade" id="bgRangeModal" tabindex="-1" aria-labelledby="bgRangeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="bgRangeModalLabel">Neuen Zielbereich festlegen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <form action="/home/bgrange" method="post" id="bgRangeForm">
                        <div class="mb-3">
                            <label for="targetBgLower" class="form-label">Zielbereich (Minimum)</label>
                            <input type="number" class="form-control" id="targetBgLower" name="targetBgLower" required>
                            <div class="form-text">Geben Sie den unteren Zielbereich in mg/dl ein.</div>
                        </div>
                        <div class="mb-3">
                            <label for="targetBgUpper" class="form-label">Zielbereich (Maximum)</label>
                            <input type="number" class="form-control" id="targetBgUpper" name="targetBgUpper" required>
                            <div class="form-text">Geben Sie den oberen Zielbereich in mg/dl ein.</div>
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="submit" form="bgRangeForm" class="btn btn-primary">Speichern</button>
                </div>
            </div>
        </div>
    </div>

</div>
